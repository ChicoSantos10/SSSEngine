name: Documentation Generation
on: 
  workflow_dispatch:
  pull_request:
    branches: [main, dev]

jobs:
  docs:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - run: sudo apt-get install -y doxygen graphviz

    - name: Generate internal docs
      run: cd docs/internal && doxygen Doxyfile_internal
    - name: Generate public docs
      run: cd docs/public && doxygen Doxyfile_public

    - name: Upload Docs
      uses: actions/upload-artifact@v4
      with:
        name: docs-internal
        path: build/docs/internal/html
    - name: Upload public Docs
      uses: actions/upload-artifact@v4
      with:
        name: docs-public
        path: build/docs/public/html

    - name: Get undocumented items
      run: |
          mkdir -p build/undoc_report
          grep -i "function" undoc.log    || true > build/undoc_report/functions.txt
          grep -i "namespace" undoc.log   || true > build/undoc_report/namespaces.txt
          grep -i "file" undoc.log        || true > build/undoc_report/files.txt
          grep -i "class" undoc.log       || true > build/undoc_report/classes.txt
          grep -i "struct" undoc.log      || true > build/undoc_report/structs.txt
          grep -i "enum" undoc.log        || true > build/undoc_report/enums.txt

    - name: Upload undocumented items
      uses: actions/upload-artifact@v4
      with:
        name: undocumented-report
        path: build/docs/internal/html/

# TODO: Upload to github pages
